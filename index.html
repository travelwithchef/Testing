alert('Invalid hex color code.');
                return;
            }
            const tolerance = parseInt(toleranceInput.value);
            processImage(rgb, tolerance);
        });

        // Convert hex color code to RGB
        function hexToRgb(hex) {
            const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(shorthandRegex, function(m, r, g, b) {
                return r + r + g + g + b + b;
            });
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        // Process the image to isolate the selected color and calculate percentage
        function processImage(selectedRgb, tolerance) {
            const ctx = canvas.getContext('2d');
            // Redraw the original image
            ctx.drawImage(originalImg, 0, 0);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            let matchingPixels = 0;

            // Analyze each pixel
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const distance = Math.sqrt(
                    Math.pow(r - selectedRgb.r, 2) +
                    Math.pow(g - selectedRgb.g, 2) +
                    Math.pow(b - selectedRgb.b, 2)
                );
                if (distance <= tolerance) {
                    matchingPixels++; // Count pixels within tolerance
                } else {
                    // Convert to grayscale
                    const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                    data[i] = gray;
                    data[i + 1] = gray;
                    data[i + 2] = gray;
                }
            }

            // Update the canvas with the processed image
            ctx.putImageData(imageData, 0, 0);

            // Calculate and display the percentage
            const totalPixels = canvas.width * canvas.height;
            const percentage = (matchingPixels / totalPixels) * 100;
            document.getElementById('percentage').textContent = `Percentage: ${percentage.toFixed(2)}%`;

            // Show the download button
            downloadBtn.style.display = 'block';
        }

        // Handle download button click
        downloadBtn.addEventListener('click', function() {
            const link = document.createElement('a');
            link.download = 'isolated_image.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    </script>
</body>
            </html>
